{% extends 'GestionDePracticas/GestionDePracticas.html' %}

{% block titulo %}
Ver {{ practica.get_tipo_display }}
{% endblock %}

{% block practica-titulo %}
{{ practica.get_tipo_display }} nÂº{{ practica.id }}: {{ practica.estado }}
{% endblock %}

{% block practica-subtitulo %}
    Ultima modificacion el dia {{ practica.estado.marca|date:"l d/m/y" }} a las {{ practica.estado.marca|date:"H:i"  }}
{% endblock %}

{% block practica-contenido %}

<div class="menu-colapsable" >

    {% if practica.estado.accionesPosibles %}
    <div class="item-colapsable" >
        <a role="button" href="#practica-actualizaciones" data-toggle="collapse">
            <i class="glyphicon glyphicon-refresh"></i>
            <span>Actualizar estado de {{ practica.get_tipo_display|lower }}</span>
        </a>
        <div class="contenido-colapsable collapse in" id="practica-actualizaciones">
            <ul class="actualizaciones sinestilo">
            {% for accion, url in acciones %}
                <li><a class="btn btn-sm btn-default" href="{{ url }}">{{ accion.value|capfirst }}</a></li>
            {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    <div class="item-colapsable" >
        <a role="button" href="#practica-historial" data-toggle="collapse">
            <i class="glyphicon glyphicon-calendar"></i>
            <span>Historial</span>
        </a>
        <div class="contenido-colapsable collapse" id="practica-historial">

            <ul class="timeline sinestilo">
            {% for estado in practica.estados.all %}
            {% if not forloop.first %}
                <li><div class="block">
                    <div class="tags">
                        <span class="tag">
                            <span>{{ estado.marca|date:"d/m/y" }}</span>
                        </span>
                    </div>
                    <div class="block_content">
                        <h2 class="title">
                            <a href="{{ request.path }}?estado={{ forloop.counter0 }}">{{ estado.related }}</a>
                        </h2>
                    </div>
                    <div class="byline">
                        <span>Efectuada por {{ estado.usuario }}</span>
                    </div>
                </div></li>
            {% endif %}
            {% endfor %}
            </ul>

        </div>
    </div>
</div>

    <p>
        <strong>{{ practica.nombreTipo|capfirst }}:</strong>
        {{ practica.id }}
    </p>
    <p>
        <strong>Cliente:</strong>
        {{ practica.cliente.nombres }}{% if practica.cliente.apellidos %} {{ practica.cliente.apellidos }}{% endif %} ({{ practica.cliente.dniCuit }})
    </p>
    {% if practica.mascota %}
    <p>
        <strong>Mascota:</strong>
        {{ practica.mascota.nombre }} ({{ practica.mascota.patente }})
    </p>
    {% endif %}
    <p>
        <strong>Tipo de Atencion:</strong>
        {{ practica.tipoDeAtencion.nombre }}
    </p>
    <p>
        <strong>Estado:</strong>
        {{ practica.nombreEstado|capfirst }}
    </p>
    <p>
        <strong>Creacion:</strong>
        {{ practica.estados.inicial.marca|date:"d/m/y" }}
    </p>
    <p>
        <strong>Ultima modificacion:</strong>
        {{ practica.estado.marca|date:"d/m/y" }}
    </p>
    <p>
        <strong>Duracion estimada:</strong>
        {{ practica.duracion }} min
    </p>
    <p id="id_precio">
        <strong>Precio previsto:</strong>
        ${{ practica.total|floatformat:2 }}
    </p>

    <p>
        <strong>Servicios:</strong>
        <table class="table-bordered table-responsive detalles" id="servicios_previstos">
            <colgroup>
                <col class="cantidad">
                <col class="servicio">
                <col class="precio">
                <col class="importe">
            </colgroup>
            <thead>
                <tr>
                    <th>Cantidad</th>
                    <th>Servicio</th>
                    <th>Precio</th>
                    <th>Importe</th>
                </tr>
            </thead>
            <tbody>
                {% for detalle in practica.practica_servicios.all %}
                <tr>
                    <td>{{ detalle.cantidad }}</td>
                    <td>{{ detalle.servicio.nombre }}</td>
                    <td>{{ detalle.precio|floatformat:2 }}</td>
                    <td>{{ detalle.precioTotal|floatformat:2 }}</td>
                </tr>
                {% endfor %}
                <tr class="breve">
                    <td colspan="3">Tipo de atencion {{ practica.tipoDeAtencion.nombre }} (%{{ practica.tipoDeAtencion.recargo|floatformat:2 }})</td>
                    <td>{{ practica.ajusteServicios|floatformat:2 }}</td>
                </tr>
                <tr class="breve">
                    <td colspan="3">Total</td>
                    <td>{{ practica.totalServicios|floatformat:2 }}</td>
                </tr>
            </tbody>
        </table>
    </p>
    <p>
        <strong>Productos:</strong>
        <table class="table-bordered table-responsive detalles" id="productos_previstos">
        <colgroup>
            <col class="cantidad">
            <col class="producto">
            <col class="precio">
            <col class="importe">
        </colgroup>
        <thead>
            <tr>
                <th>Cantidad</th>
                <th>Producto</th>
                <th>Precio</th>
                <th>Importe</th>
            </tr>
        </thead>
        <tbody>
            {% for detalle in practica.practica_productos.all %}
            <tr>
                <td>{{ detalle.cantidad }}</td>
                <td>{{ detalle.producto.nombre }}</td>
                <td>{{ detalle.precio|floatformat:2 }}</td>
                <td>{{ detalle.precioTotal|floatformat:2 }}</td>
            </tr>
            {% endfor %}
            <tr class="breve">
                <td colspan="3">Tipo de atencion {{ practica.tipoDeAtencion.nombre }} (%{{ practica.tipoDeAtencion.recargo|floatformat:2 }})</td>
                <td>{{ practica.ajusteProductos|floatformat:2 }}</td>
            </tr>
            <tr class="breve">
                <td colspan="3">Total</td>
                <td>{{ practica.totalProductos|floatformat:2 }}</td>
            </tr>
        </tbody>
        </table>
    </p>

{% block estado %}
{% endblock %}

<div class="menu-colapsable" >
    {% if practica.nombreEstado == "presupuestada" %}
        {% include "./snippets/acciones/presupuestada.html" %}
    {% elif practica.nombreEstado == "programada" %}
        {% include "./snippets/acciones/programada.html" %}
    {% elif practica.nombreEstado == "cancelada" %}
        {% include "./snippets/acciones/cancelada.html" %}
    {% elif practica.nombreEstado == "realizada" %}
        {% include "./snippets/acciones/realizada.html" %}
    {% elif practica.nombreEstado == "facturada" %}
        {% include "./snippets/acciones/facturada.html" %}
    {% endif %}
</div>

{% endblock %}
